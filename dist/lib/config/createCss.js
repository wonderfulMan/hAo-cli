"use strict";exports.__esModule=!0;var cli_shared_utils_1=require("@lartplus/cli-shared-utils"),cli_config_1=require("@lartplus/cli-config"),CreateStyleVueRules=function(){function s(s,e){this.context=s,this.chain=e,this.isProd="dev"!==this.context.mode,this.shouldExtract=!this.isProd}return s.prototype.apploaders=function(s,e,t,o){var a,i=(null===(a=this.context.configFile)||void 0===a?void 0:a.cssSouceMap)||!0;this.shouldExtract?s.use("extract-css-plugin").loader(cli_shared_utils_1.maybeLoader("mini-css-extract-plugin")).options({hmr:!this.shouldExtract}):s.use("vue-style-loader").loader(cli_shared_utils_1.maybeLoader("vue-style-loader")).options({sourceMap:i,shadowMode:!0});var r=this.calcCssLoaderOptions(i,e);s.use("css-loader").loader(cli_shared_utils_1.maybeLoader("css-loader")).options(r),s.use("postcss-loader").loader(cli_shared_utils_1.maybeLoader("postcss-loader")).options({sourceMap:i}),t&&s.use(t).loader(cli_shared_utils_1.maybeLoader(t)).options(Object.assign({sourceMap:i},o))},s.prototype.createRules=function(s,e,t,o){var a=this.chain.module.rule(s).test(e),i=a.oneOf("vue-normal").resourceQuery(/\?vue/);this.apploaders(i,!1,t,o);var r=a.oneOf("vue-module").resourceQuery(/module/);this.apploaders(r,!0,t,o);var l=a.oneOf("normal");this.apploaders(l,!1,t,o);var c=a.oneOf("normal-modules").test(language.MODULES);this.apploaders(c,!0,t,o)},s.prototype.calcCssLoaderOptions=function(s,e){var t={sourceMap:s,importLoaders:2};return e&&(t.localIdentName="[name]_[local]_[hash:base64:5]",t.modules=!0),t},s.prototype.setCssPlugin=function(){var s,e,t="css/[name]"+((null===(s=this.context.configFile)||void 0===s?void 0:s.cssFileNameWithHash)||!0?".[contenthash:8]":"")+".css",o={filename:t,chunkFilename:t};this.shouldExtract&&(this.chain.plugin("extract-css").use(cli_shared_utils_1.maybeLoader("mini-css-extract-plugin"),[o]),e={cssProcessor:cli_shared_utils_1.maybeLoader("cssnano"),cssProcessorOptions:{reduceIdents:!1,autoprefixer:!1,safe:!0,discardComments:{removeAll:!0}}},this.isProd&&this.chain.optimization.minimizer("optimize-css-assets-webpack-plugin").use(cli_shared_utils_1.maybeLoader("optimize-css-assets-webpack-plugin"),[e]))},s.prototype.buildStyle=function(){this.createRules("css",cli_config_1.LANGUAGE_TYPE.CSS),this.createRules("less",cli_config_1.LANGUAGE_TYPE.LESS,"less-loader"),this.createRules("stylus",cli_config_1.LANGUAGE_TYPE.STYLUS,"stylus-loader"),this.createRules("postcss",cli_config_1.LANGUAGE_TYPE.POST),this.createRules("sass",cli_config_1.LANGUAGE_TYPE.SASS,"sass-loader"),this.createRules("scss",cli_config_1.LANGUAGE_TYPE.SCSS,"sass-loader")},s}();exports.CreateStyleVueRules=CreateStyleVueRules;