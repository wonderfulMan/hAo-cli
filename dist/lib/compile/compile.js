"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var a in r=arguments[n])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,s,o,u){return new(o=o||Promise)(function(n,r){function t(e){try{i(u.next(e))}catch(e){r(e)}}function a(e){try{i(u.throw(e))}catch(e){r(e)}}function i(e){var r;e.done?n(e.value):((r=e.value)instanceof o?r:new o(function(e){e(r)})).then(t,a)}i((u=u.apply(e,s||[])).next())})},__generator=this&&this.__generator||function(n,t){var a,i,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},e={next:r(0),throw:r(1),return:r(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function r(r){return function(e){return function(r){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,i&&(s=2&r[0]?i.return:r[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,r[1])).done)return s;switch(i=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(n,o)}catch(e){r=[6,e],i=0}finally{a=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,e])}}};exports.__esModule=!0;var cli_shared_utils_1=require("@lartplus/cli-shared-utils"),parseEntries_1=require("../parse/parseEntries"),parseEnv_1=require("../parse/parseEnv"),parseTemplate_1=require("../parse/parseTemplate"),parseMerge_1=require("../parse/parseMerge"),generatorChainConfig_1=require("../config/generatorChainConfig"),server_1=require("./server"),validate=function(e){return"dev"==e||"build"==e||(cli_shared_utils_1.notice.error(["目前只支持dev/build模式"]),!1)},compile=function(c,p){return __awaiter(void 0,void 0,void 0,function(){var r,n,t,a,i,s,o,u,l;return __generator(this,function(e){switch(e.label){case 0:return r=c.mode,validate(r)?[4,parseEnv_1.parseEnv(c,p)]:[3,6];case 1:return n=e.sent(),[4,parseEntries_1.parseEntries(p)];case 2:return t=e.sent(),[4,parseTemplate_1.parseTemplate(p,t)];case 3:return a=e.sent(),i=parseMerge_1.parseMerge(t,a),s=__assign(__assign({},p),{env:n,mode:r}),o=new generatorChainConfig_1.GeneratorChainConfig(s,i),u=o.generatorBaseConfig(),(l=s.configFile.webpackChain)&&"function"==typeof l?[4,l(u)]:[3,5];case 4:e.sent(),e.label=5;case 5:"dev"===r&&server_1.startServer(u,s,i),e.label=6;case 6:return[2]}})})};exports.compile=compile;